<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generar Reportes</title>
    <!-- CSS de SweetAlert2 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
</head>
<body>
    <div style="text-align: center; margin-top: 50px;">
        <h1>Generar Reportes</h1>
        <!-- Botones para los diferentes reportes -->
        <div style="margin-top: 20px;">
            <button class="report-button" data-report="estudiantes" style="padding: 10px 20px; font-size: 16px;">Reporte de Estudiantes</button>
            <button class="report-button" data-report="secciones" style="padding: 10px 20px; font-size: 16px;">Reporte de Secciones</button>
            <button class="report-button" data-report="cursos" style="padding: 10px 20px; font-size: 16px;">Reporte de Cursos</button>
            <button class="report-button" data-report="profesores" style="padding: 10px 20px; font-size: 16px;">Reporte de Profesores</button>
            <button class="report-button" data-report="facturas" style="padding: 10px 20px; font-size: 16px;">Reporte de Facturas</button>
            <button class="report-button" data-report="tarifas" style="padding: 10px 20px; font-size: 16px;">Reporte de Tarifas</button>
            <button class="report-button" data-report="AnioEscolar" style="padding: 10px 20px; font-size: 16px;">Reporte de anio</button>
      
        </div>
    </div>

    <!-- Sección para mostrar los reportes -->
    <div id="report-section" style="display: none; padding: 20px; margin-top: 30px; border: 1px solid #ccc; border-radius: 8px;">
        <h2 id="report-title">Reporte</h2>
        <table class="styled-table" style="width: 100%; border-collapse: collapse;">
            <thead>
                <tr id="table-headers">
                    <!-- Encabezados dinámicos -->
                </tr>
            </thead>
            <tbody id="table-body">
                <!-- Filas dinámicas -->
            </tbody>
        </table>
    </div>

    <iframe id="pdf-viewer" style="width: 100%; height: 600px; border: none;"></iframe>

    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Configuración base de las URLs para cada reporte
            const reportUrls = {
                estudiantes: 'https://web-production-3f4f.up.railway.app/reporte/reporte-estudiantes/',
                secciones: 'https://web-production-3f4f.up.railway.app/reporte/reporte-secciones/',
                cursos: 'https://web-production-3f4f.up.railway.app/reporte/reporte-cursos/',
                profesores: 'https://web-production-3f4f.up.railway.app/reporte/reporte-profesores/',
                facturas: 'https://web-production-3f4f.up.railway.app/reporte/reporte-facturas/',
                tarifas: 'https://web-production-3f4f.up.railway.app/reporte/reporte-tarifas/',
                anio: 'https://web-production-3f4f.up.railway.app/reporte/reportes-anioescolar/',
            };

            // Evento para cada botón de reporte
            document.querySelectorAll('.report-button').forEach(button => {
                button.addEventListener('click', async () => {
                    const reportType = button.dataset.report;

                    // Pedir rango de fechas
                    const result = await Swal.fire({
                        title: 'Selecciona el rango de fechas',
                        html: `  
                            <input type="date" id="fechaInicio" class="swal2-input" placeholder="Fecha de inicio">
                            <input type="date" id="fechaFin" class="swal2-input" placeholder="Fecha de fin">
                        `,
                        focusConfirm: false,
                        preConfirm: () => {
                            const fechaInicio = document.getElementById('fechaInicio').value;
                            const fechaFin = document.getElementById('fechaFin').value;
                            if (!fechaInicio || !fechaFin) {
                                Swal.showValidationMessage('Ambas fechas son obligatorias');
                                return false;
                            }
                            return { fechaInicio, fechaFin };
                        }
                    });

                    if (result.isConfirmed) {
                        const { fechaInicio, fechaFin } = result.value;
                        const url = `${reportUrls[reportType]}?fecha_inicio=${fechaInicio}&fecha_fin=${fechaFin}`;

                        try {
                            const response = await fetch(url);
                            const data = await response.json();

                            if (data && data[reportType] && data[reportType].length > 0) {
                                mostrarReporte(data[reportType], reportType);
                            } else {
                                Swal.fire({
                                    icon: 'info',
                                    title: 'Sin resultados',
                                    text: `No se encontraron datos para el reporte de ${reportType} en el rango seleccionado.`,
                                });
                            }
                        } catch (error) {
                            Swal.fire({
                                icon: 'error',
                                title: 'Error',
                                text: `No se pudo obtener el reporte de ${reportType}: ${error.message}`,
                            });
                        }
                    }
                });
            });

            function mostrarReporte(data, reportType) {
                const reportTitle = {
                    estudiantes: 'Reporte de Estudiantes',
                    secciones: 'Reporte de Secciones',
                    cursos: 'Reporte de Cursos',
                    profesores: 'Reporte de Profesores',
                    facturas: 'Reporte de Facturas',
                    tarifas: 'Reporte de Tarifas',
                    anio: 'Reporte de anios escolares',
                };

                const headers = {
                    estudiantes: ['Matricula', 'Nombre', 'Apellido', 'Fecha de Ingreso'],
                    secciones: ['ID', 'Nombre', 'Descripción'],
                    cursos: ['ID', 'Nombre del Curso', 'Duración'],
                    profesores: ['ID', 'Nombre', 'Especialidad'],
                    facturas: ['ID', 'Cliente', 'Monto', 'Fecha'],
                    tarifas: ['ID', 'Concepto', 'Costo'],
                    anio: ['ID', 'anio', 'activo'],
                };

                const tbody = document.getElementById('table-body');
                const thead = document.getElementById('table-headers');
                const reportSection = document.getElementById('report-section');
                document.getElementById('report-title').innerText = reportTitle[reportType];
                tbody.innerHTML = '';
                thead.innerHTML = '';

                // Crear encabezados
                headers[reportType].forEach(header => {
                    const th = document.createElement('th');
                    th.innerText = header;
                    th.style.backgroundColor = '#4CAF50';
                    th.style.color = 'white';
                    th.style.padding = '10px';
                    thead.appendChild(th);
                });

                // Crear filas
                data.forEach(item => {
                    const tr = document.createElement('tr');
                    headers[reportType].forEach(key => {
                        const td = document.createElement('td');
                        td.innerText = item[key.toLowerCase()] || 'N/A';
                        td.style.padding = '10px';
                        td.style.border = '1px solid #ddd';
                        tr.appendChild(td);
                    });
                    tbody.appendChild(tr);
                });

                // Mostrar la tabla
                reportSection.style.display = 'block';
            }
        });
    </script>
</body>
</html>
